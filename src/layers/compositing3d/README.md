# Compositing 3D

本模块负责处理图层的 3D 变换与合成。当图层应用了 3D 变换矩阵时，简单的 2D 绘制顺序（Painter's Algorithm）可能无法正确处理复杂的遮挡关系（如相交平面）。本模块引入了 BSP（Binary Space Partitioning）树算法来解决这一问题。

## 核心功能

1.  **3D 空间变换**：处理图层在 3D 空间中的顶点变换。
2.  **深度排序**：使用 BSP 树对 3D 多边形进行空间分割和排序，确保正确的渲染顺序（从后往前或从前往后）。
3.  **合成绘制**：将排序后的 3D 内容绘制到目标 Canvas 上。

## 关键类说明

*   **Context3DCompositor**: 3D 合成器的主入口。负责管理 3D 上下文，接收 3D 绘制请求，并执行最终的合成操作。
*   **BspTree**: 二叉空间分割树的实现。用于存储和分割 3D 多边形，构建场景的空间结构。
*   **DrawPolygon3D**: 定义 3D 多边形的数据结构，包含顶点坐标、纹理坐标等信息。
*   **Layer3DContext**: 维护图层的 3D 状态上下文。
*   **Render3DContext / Opaque3DContext**: 针对不同渲染需求（普通渲染/不透明渲染）的 3D 上下文实现。
